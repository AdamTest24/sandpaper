<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with Automated Pull Requests • sandpaper</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with Automated Pull Requests">
<meta property="og:description" content="sandpaper">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@zkamvar">
<meta name="twitter:site" content="@thecarpentries">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sandpaper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9056</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/building-with-renv.html">Building Lessons With A Package Cache</a>
    </li>
    <li>
      <a href="../articles/automated-pull-requests.html">Working with Automated Pull Requests</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/index.html">More...</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/carpentries/sandpaper/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="automated-pull-requests_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with Automated Pull Requests</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/carpentries/sandpaper/blob/master/vignettes/automated-pull-requests.Rmd"><code>vignettes/automated-pull-requests.Rmd</code></a></small>
      <div class="hidden name"><code>automated-pull-requests.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>One of the innovations of {sandpaper} is the out-of-the-box integration with GitHub Actions by supplying several workflows that deploy, validate, and update the lesson. This vignette will focus on the latter set of workflows: those that update the lesson in some form. In this vignette, we will outline the components of the lesson that need updating, demonstrate pull requests and the requirements to set them up on a non-carpentries account, and demonstrate functions to manually update these components.</p>
</div>
<div id="components-which-need-to-be-updated" class="section level2">
<h2 class="hasAnchor">
<a href="#components-which-need-to-be-updated" class="anchor"></a>Components which Need to be Updated</h2>
<p>The concept of a {sandpaper} lesson is simple: place a set of markdown or R markdown files in a folder, run a command, and get a website out of it. It’s not much different than a static site generator. What makes it different is that, with a {sandpaper} lesson, you are no longer solely responsible for ensuring that the styling and build tools are kept up-to-date as these have been stripped from the repository and separated into three stand-alone packages. There are, however two places in a lesson where build requirements still live and will need updating from time to time:</p>
<ol style="list-style-type: decimal">
<li>Continuous Integration Workflows (in the <code>.github/</code> folder)</li>
<li>Lesson Requirements for Generated Content (in the <code>renv/</code> folder)</li>
</ol>
<p>A lesson created with {sandpaper} relies on deployment workflows that live inside the <code>.github/</code> folder to ensure that it can not only be properly deployed, but also that pull requests can be tested and validated. Additionally, if you have a lesson that uses generated content via R Markdown, then you will have a folder called <code>renv/</code> in your repository. This folder will contain a lockfile at <code>renv/profiles/lesson-requirements/renv.lock</code>, which will detail the packages required to build the lesson, along with their versions and specific hash of the package contents.</p>
</div>
<div id="pull-request-updates" class="section level2">
<h2 class="hasAnchor">
<a href="#pull-request-updates" class="anchor"></a>Pull Request Updates</h2>
<p>When you host a lesson on one of The Carpentries’ repositories, the automated workflows will periodically check for updates and issue pull requests <em>if there are available updates</em>. These pull requests are designed to be minimally invasive and predictable to ensure that your lesson remains up-to-date.</p>
<p>In addition to being run periodically, you can run them at any time by going to your repository &gt; actions and selecting one of the workflows that starts with “Maintain”. There will be a button that says “Run Workflow” that you can push and it will start the process of checking for updates.</p>
<div id="weekly-checks-update-workflows" class="section level3">
<h3 class="hasAnchor">
<a href="#weekly-checks-update-workflows" class="anchor"></a>Weekly Checks: Update Workflows</h3>
<p>On a weekly basis, the workflow located in <code>.github/workflows/update-workflows.yaml</code> will run and update the workflow files with the current versions from {sandpaper}. This will then create a pull request with the title “Update Workflows to Version X.Y.Z” from the <a href="https://github.com/znk-machine">Carpentries Apprentice Bot</a>. <em>A pull request is only created if there are updates to be had, otherwise, it will report that there are no updates at this time.</em></p>
<p>Check to make sure that this workflow <em>only</em> contains modified workflows in the .<code>github/workflows/</code> and that no secrets have been accidentally divulged.</p>
</div>
<div id="monthly-checks-update-lesson-requirements" class="section level3">
<h3 class="hasAnchor">
<a href="#monthly-checks-update-lesson-requirements" class="anchor"></a>Monthly Checks: Update Lesson Requirements</h3>
<p>On a monthly basis, if the lesson has generated content, the workflow in <code>.github/workflows/update-cache.yaml</code> will run to check for updates to the lockfile in <code>renv/profiles/lesson-requirements/renv.lock</code>. This pull request will change only the <code>renv.lock</code> file and it will report in the pull request itself what packages have changed.</p>
<p>This pull request will be followed closely by a comment that will inform you what has changed in the generated content based on the new versions. If the packages are relatively stable, then not much should change. This is the time to inspect the generated output for any errors that occurr due to packages updating their expectations or dependencies.</p>
</div>
<div id="setting-up-a-pull-request-bot" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-a-pull-request-bot" class="anchor"></a>Setting up a Pull Request Bot</h3>
<p>Both of these pull requests are provided with the help of <a href="https://github.com/znk-machine">The Carpentries Apprentice Bot</a>. This bot is available across The Carpentries github organisations and if you have a lesson hosted on one of these organisations, then you do not need to worry about this section.</p>
<p>If you are hosting your own lesson and would like to take advantage of these periodic updates, you do not necessarily need a bot account, but you do need access to an account that has the following aspects</p>
<ol style="list-style-type: decimal">
<li>Access to your lesson repository (as a collaborator or self), and</li>
<li>A Personal Access Token registered as <code>SANDPAPER_WORKFLOW</code> in that repository with the <code>repo</code> and <code>workflow</code> scopes</li>
</ol>
<div id="creating-a-pat" class="section level4">
<h4 class="hasAnchor">
<a href="#creating-a-pat" class="anchor"></a>Creating a PAT</h4>
<p>Whether or not you choose to use a bot account or your own account, you will need to <a href="https://github.com/settings/tokens/new?scopes=repo,workflow&amp;description=Sandpaper%20Token">generate a new Personal Access Token with the repo and workflow scope</a>.</p>
<p>Once there, add more context in the <code>Note</code> field, set an expiration date (default is 30 days), scroll down to the bottom of the page and select “Generate Token”</p>
<p>Your token will appear in a green box and will start with <code>ghp_</code>. Copy the token by clicking on the clipboard symbol immediately to the right of the token and then go to your repository &gt; settings &gt; secrets and select “New Repository Secret” if you haven’t created the <code>SANDPAPER_WORKFLOW</code> secret before. Add <code>SANDPAPER_WORKFLOW</code> in the “Name” field and paste your token in the “Value” field.</p>
</div>
</div>
</div>
<div id="manual-updates" class="section level2">
<h2 class="hasAnchor">
<a href="#manual-updates" class="anchor"></a>Manual Updates</h2>
<p>If you want to create updates manually without using GitHub Actions, there are two functions available:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/update_github_workflows.html">update_github_workflows</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># updates the package workflows</span>
<span class="fu"><a href="../reference/manage_deps.html">update_cache</a></span><span class="op">(</span><span class="op">)</span>      <span class="co"># uses `renv::update()` to check for updates to the package cache</span></code></pre></div>
<p>Both of these functions will modify files locally so if you do not like them, you can use <code>git restore .</code> to revert them to their original state.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zhian N. Kamvar.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
